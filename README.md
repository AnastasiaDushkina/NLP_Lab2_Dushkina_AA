# Мультиагентный помощник по настольным играм

**Лабораторная работа 2: Проектирование и реализация мультиагентной системы с использованием LangChain и LangGraph**

Душкина Анастасия Алексеевна, группа J4140

## Описание проекта

Этот проект реализует мультиагентную систему (МАС) на основе LangChain и LangGraph, которая помогает решать практические задачи:
- **Подбирать настольные игры** по критериям (количество игроков, время, сложность, жанры, темы, механики)
- **Сравнивать настольные игры** по различным параметрам
- **Объяснять игровые термины** (механики, жанры) из глоссария или через LLM
- **Отвечать на академические вопросы** по мультиагентным системам, LLM и архитектуре ИИ-приложений

Система использует паттерн **router + специализированные агенты**, работает с локальной базой игр и глоссарием b сохраняет краткую историю взаимодействий

## Архитектура системы

Система построена как граф (StateGraph), где каждый узел представляет отдельного специализированного агента:

### Агенты

1. **Router (Роутер)** — определяет тип запроса пользователя:
   - `recommend` — подбор настольной игры
   - `explain` — объяснение термина
   - `compare` — сравнение двух игр
   - `academic` — академический вопрос

2. **Recommender (Рекомендатель)** — подбирает игры по критериям:
   - Парсит запрос пользователя в структурированный план (Pydantic)
   - Фильтрует игры по техническим параметрам (метаданные)
   - Фильтрует по содержанию (жанры, темы, механики)
   - Выбирает наиболее подходящую игру

3. **Explainer (Объяснитель)** — объясняет игровые термины:
   - Сначала ищет термин в локальном глоссарии (GLOSSARY)
   - Если не находит, обращается к LLM для объяснения

4. **Comparator (Сравниватель)** — сравнивает две игры:
   - Ищет названия игр в запросе через поиск по базе данных
   - Передает данные игр в LLM для сравнения

5. **Academic (Академический агент)** — отвечает на учебные вопросы:
   - Обрабатывает вопросы по мультиагентным системам, LLM, архитектуре ИИ

6. **Memory (Агент памяти)** — сохраняет историю диалога:
   - Сохраняет пары вопрос-ответ
   - Ограничивает историю последними 3 взаимодействиями

### Поток выполнения

```
User Query - Router = [Explainer | Comparator | Academic | Recommender] - Memory - END
```

Каждый запрос проходит через роутер который направляет его к соответствующему специализированному агенту. После обработки результат сохраняется в памяти и выполнение завершается

## Структура данных

### Game (Модель игры)
- `name` — название игры
- `players_min/max` — количество игроков
- `duration_min/max` — длительность партии (минуты)
- `min_age` — минимальный возраст
- `complexity` — сложность (1.0-5.0)
- `genres` — жанры
- `themes` — тематики
- `mechanics` — игровые механики
- `interaction` — уровень взаимодействия
- `language_dependence` — языковая зависимость
- `description` — описание

### GraphState (Состояние графа)
- `user_query` — запрос пользователя
- `chat_history` — история диалога
- `intent` — определенный тип запроса
- `final_answer` — финальный ответ
- `execution_path` — путь выполнения (последовательность агентов)
- `intermediate` — промежуточные данные

## Установка и настройка

### Требования

- **Python 3.9 или новее**
- Доступ к LLM через API (LiteLLM или OpenAI)

### Установка зависимостей

Установите необходимые библиотеки:

```bash
pip install -r requirements.txt
```

Или вручную:

```bash
pip install openai langchain langchain-openai langchain-core langgraph pydantic python-dotenv
```

### Настройка окружения

Создайте файл `.env` в корне проекта со следующими параметрами:

```env
LITELLM_BASE_URL=http://your-vllm-server:34000/v1
LITELLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
MODEL_NAME=xxxxx-xxx
```

Или для OpenAI:

```env
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## Использование

### Запуск в Jupyter Notebook

Откройте файл `NLP_Lab2_Dushkina_AA.ipynb` и выполните все ячейки. В системе прописаны 6 тестовых запросов:

1. Рекомендация игры для вечеринки
2. Объяснение термина "драфт"
3. Сравнение двух игр (Каскадия и Азул)
4. Академический вопрос о паттерне router
5. Вопрос по проектированию МАС
6. Вопрос по программированию LangGraph

### Примеры запросов

```python
from your_module import create_app

app = create_app()

# Рекомендация игры
result = app.invoke({
    "user_query": "Порекомендуй настольную игру для вечеринки из 6 человек, чтобы было весело и быстро",
    "chat_history": [],
    "execution_path": [],
    "intermediate": {}
})

print(result["final_answer"])
print(f"Активированные агенты: {' - '.join(result['execution_path'])}")
```

## База данных игр

Система включает локальную базу из 12 популярных настольных игр:
- Каскадия
- Азул
- Пандемия
- Доббль
- Корни (Root)
- Уютная усадьба
- Колонизаторы
- Кодовые имена
- Ужас Аркхэма
- 7 чудес
- Манчкин
- Вингспан

## Глоссарий

Система включает глоссарий игровых терминов:
- драфт
- worker placement
- тайл-placement
- кооператив
- сет-коллекшн
- блюфф
- милитария

